<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PDF Question Finder</title>
<script src="https://cdn.tailwindcss.com"></script>
<!-- Add jsPDF library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body { background: linear-gradient(135deg, #f0f4f8, #d9e2ec); }
#drop-zone.dragover { border-color: #3b82f6; background-color: #e0f2fe; }
</style>
</head>
<body class="min-h-screen flex flex-col items-center justify-start py-10">

<h1 class="text-4xl font-bold mb-4 text-gray-800">PDF Question Finder 'text based only' v1</h1>
<p class="text-gray-600 mb-8 text-center max-w-xl">
  Upload up to 10 PDFs and see all unique questions with how many times they appeared.
</p>

<div id="drop-zone" class="w-96 h-48 border-4 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center cursor-pointer transition-all">
  <svg class="w-12 h-12 text-gray-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v4a2 2 0 002 2h12a2 2 0 002-2v-4M12 12v8m0 0l-4-4m4 4l4-4m-4-8V4m0 0l-4 4m4-4l4 4"/>
  </svg>
  <p class="text-gray-500 text-center">Drag & drop PDFs here<br>or click to select files</p>
  <input type="file" id="fileInput" multiple accept=".pdf" hidden>
</div>

<button id="uploadBtn" class="mt-6 px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-md">
  Upload & Analyze
</button>

<div id="results" class="mt-8 w-full max-w-5xl px-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>

<button id="downloadBtn" class="mt-4 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 shadow-md hidden">
  Download Results
</button>

<script>
const dropZone = document.getElementById("drop-zone");
const fileInput = document.getElementById("fileInput");
const downloadBtn = document.getElementById("downloadBtn");
let selectedFiles = [];
let resultData = []; // store results for PDF

dropZone.addEventListener("click", () => fileInput.click());
fileInput.addEventListener("change", e => selectedFiles = Array.from(e.target.files));
dropZone.addEventListener("dragover", e => { e.preventDefault(); dropZone.classList.add("dragover"); });
dropZone.addEventListener("dragleave", () => dropZone.classList.remove("dragover"));
dropZone.addEventListener("drop", e => { e.preventDefault(); selectedFiles = Array.from(e.dataTransfer.files); dropZone.classList.remove("dragover"); });

document.getElementById("uploadBtn").addEventListener("click", async () => {
  if(selectedFiles.length === 0){ alert("Please select at least one PDF."); return; }

  let formData = new FormData();
  selectedFiles.forEach(f => formData.append("pdfs", f));

  const resultsDiv = document.getElementById("results");
  resultsDiv.innerHTML = `<p class="text-gray-600 col-span-full">Analyzing PDFs... please wait.</p>`;
  downloadBtn.classList.add("hidden");

  try {
    let res = await fetch("/upload", { method: "POST", body: formData });
    let data = await res.json();

    if(data.error){
      resultsDiv.innerHTML = `<p class="text-red-500 col-span-full">${data.error}</p>`;
      return;
    }

    resultData = data; // save for PDF
    resultsDiv.innerHTML = "";

    data.forEach((item,index) => {
      resultsDiv.innerHTML += `
        <div class="bg-white shadow-md p-4 rounded border-l-4 border-blue-500 hover:shadow-lg transition">
          <p class="font-semibold">Q${index+1}:</p>
          <p class="text-gray-700 mt-1">${item.question}</p>
          <p class="text-sm text-gray-400 mt-1">Seen: ${item.count} times</p>
        </div>`;
    });

    downloadBtn.classList.remove("hidden");
    downloadBtn.onclick = () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(18);
      doc.text("Most Repeated Questions", 10, 10);
      let y = 20;

      data.forEach((item,index) => {
        doc.setFontSize(12);
        doc.text(`Q${index+1}: ${item.question}`, 10, y);
        y += 7;
        doc.setFontSize(10);
        doc.text(`Times Found: ${item.count}`, 10, y);
        y += 10;
        if(y > 280){ doc.addPage(); y = 10; }
      });

      doc.save("most_repeated_questions.pdf");
    };

  } catch(err){
    resultsDiv.innerHTML = `<p class="text-red-500 col-span-full">Error analyzing PDFs. Check console.</p>`;
    console.error(err);
  }
});
</script>
</body>
</html>
